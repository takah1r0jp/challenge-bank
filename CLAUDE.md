# Failure Bank - å¤±æ•—ã‚’è²¯é‡‘ã™ã‚‹ã‚¢ãƒ—ãƒª

æŒ‘æˆ¦ã‚’ç¿’æ…£åŒ–ã—ã€æˆé•·ã‚’å¯è¦–åŒ–ã™ã‚‹ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ—¥ã€…ã®å¤±æ•—ã‚’è¨˜éŒ²ãƒ»å¯è¦–åŒ–ã—ã€æŒ‘æˆ¦ã‚’ç¿’æ…£åŒ–ã™ã‚‹ãŸã‚ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã™ã€‚å¤±æ•—ã‚’ã€Œè²¯é‡‘ã€ã¨ã—ã¦æ‰ãˆã‚‹ã“ã¨ã§ã€æŒ‘æˆ¦ã™ã‚‹ã“ã¨ã¸ã®å¿ƒç†çš„ãƒãƒ¼ãƒ‰ãƒ«ã‚’ä¸‹ã’ã€ç¶™ç¶šçš„ãªæˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

## ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯æ§‹æˆ

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Framework**: Next.js (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Deploy**: Vercel

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆbackend/ï¼‰
- **Framework**: FastAPI 0.121.1+
- **ORM**: SQLAlchemy 2.0.44+
- **Database**: PostgreSQL
- **èªè¨¼**: JWT + Argon2ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™: 10æ—¥ï¼‰
- **Deploy**: Render / Railway

### é€šçŸ¥
- **ãƒ¡ãƒ¼ãƒ«é€šçŸ¥**: SendGrid / Resend
- **ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥**: Web Push APIï¼ˆæ¤œè¨ä¸­ï¼‰

## MVPæ©Ÿèƒ½

### 1. èªè¨¼æ©Ÿèƒ½ï¼ˆå®Ÿè£…æ¸ˆã¿âœ…ï¼‰
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ + ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
- JWT ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹
- é€šçŸ¥æ™‚é–“è¨­å®šï¼ˆnotification_timeï¼‰

### 2. å¤±æ•—ã®è¨˜éŒ²ï¼ˆå®Ÿè£…æ¸ˆã¿âœ…ï¼‰
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤±æ•—ã‚’è¨˜éŒ²ã™ã‚‹éš›ã«ä»¥ä¸‹ã®æƒ…å ±ã‚’å…¥åŠ›ï¼š

- **å¤±æ•—å†…å®¹**ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰: content
- **ã‚¹ã‚³ã‚¢**ï¼ˆæ•´æ•°ï¼‰: score
- **è¨˜éŒ²æ—¥æ™‚**ï¼ˆè‡ªå‹•ï¼‰: created_at
- **æ›´æ–°æ—¥æ™‚**ï¼ˆè‡ªå‹•ï¼‰: updated_at

**å°†æ¥çš„ãªæ‹¡å¼µå€™è£œ:**
- challenge_contentï¼ˆæŒ‘æˆ¦å†…å®¹ï¼‰
- failure_contentï¼ˆå¤±æ•—å†…å®¹ã®è©³ç´°ï¼‰
- next_actionï¼ˆãƒã‚¯ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
- challenge_levelï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸åº¦åˆã„: 1-3ï¼‰
- novelty_levelï¼ˆæ–°ã—ã„åº¦åˆã„: 1-3ï¼‰

### 3. å¯è¦–åŒ–æ©Ÿèƒ½ï¼ˆå®Ÿè£…æ¸ˆã¿âœ…ï¼‰
- **çµ±è¨ˆã‚µãƒãƒªãƒ¼**: å…¨æœŸé–“/ä»Šé€±/ä»Šæœˆã®å¤±æ•—æ•°ãƒ»ã‚¹ã‚³ã‚¢ãƒ»å¹³å‡ã‚¹ã‚³ã‚¢
- **ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼**: æŒ‡å®šæœˆã®æ—¥åˆ¥çµ±è¨ˆï¼ˆå¤±æ•—æ•°ã€åˆè¨ˆã‚¹ã‚³ã‚¢ã€å¹³å‡ã‚¹ã‚³ã‚¢ï¼‰

### 4. é€šçŸ¥æ©Ÿèƒ½ï¼ˆå®Ÿè£…äºˆå®šï¼‰
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ï¼ˆSendGrid/Resendçµ±åˆï¼‰
- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¨­å®šï¼ˆå®šæœŸå®Ÿè¡Œï¼‰
- â€» notification_timeãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å®Ÿè£…æ¸ˆã¿

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Framework**: FastAPI 0.121.1+
- **Database**: PostgreSQL
- **ORM**: SQLAlchemy 2.0.44+
- **èªè¨¼**: JWT + Argon2ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™: 10æ—¥ï¼‰
- **ãƒ†ã‚¹ãƒˆ**: pytest + httpx
- **ã‚³ãƒ¼ãƒ‰å“è³ª**: Ruff
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†**: uv

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
backend/
â”œâ”€â”€ main.py          # FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®šç¾©
â”œâ”€â”€ models.py        # SQLAlchemyãƒ¢ãƒ‡ãƒ«ï¼ˆUser, Failureï¼‰
â”œâ”€â”€ schemas.py       # Pydanticã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ database.py      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šè¨­å®š
â”œâ”€â”€ auth.py          # èªè¨¼é–¢é€£ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ init_db.py       # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ tests/           # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”œâ”€â”€ pyproject.toml   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â””â”€â”€ CLAUDE.md        # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## å®Ÿè£…çŠ¶æ³

### âœ… å®Ÿè£…æ¸ˆã¿ï¼ˆMVPå®Œäº†ï¼‰
**èªè¨¼æ©Ÿèƒ½:**
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ï¼ˆ`POST /auth/register`ï¼‰
- [x] ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ`POST /auth/login`ï¼‰
- [x] èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ï¼ˆ`GET /auth/me`ï¼‰
- [x] ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°ï¼ˆ`PUT /auth/me`ï¼‰- notification_timeæ›´æ–°å¯¾å¿œ
- [x] ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆ`POST /auth/logout`ï¼‰- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ãƒˆãƒ¼ã‚¯ãƒ³å‰Šé™¤æ–¹å¼
- [x] Userãƒ¢ãƒ‡ãƒ«ï¼ˆnotification_timeå¯¾å¿œï¼‰
- [x] ç’°å¢ƒå¤‰æ•°åŒ–ï¼ˆJWT_SECRET_KEY, DATABASE_URLï¼‰

**å¤±æ•—è¨˜éŒ²CRUD:**
- [x] å¤±æ•—è¨˜éŒ²ä½œæˆï¼ˆ`POST /failures`ï¼‰
- [x] å¤±æ•—è¨˜éŒ²ä¸€è¦§å–å¾—ï¼ˆ`GET /failures`ï¼‰- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œ
- [x] å¤±æ•—è¨˜éŒ²è©³ç´°å–å¾—ï¼ˆ`GET /failures/{id}`ï¼‰
- [x] å¤±æ•—è¨˜éŒ²æ›´æ–°ï¼ˆ`PUT /failures/{id}`ï¼‰
- [x] å¤±æ•—è¨˜éŒ²å‰Šé™¤ï¼ˆ`DELETE /failures/{id}`ï¼‰
- [x] Failureãƒ¢ãƒ‡ãƒ«ï¼ˆcontent, score, created_at, updated_atï¼‰

**çµ±è¨ˆãƒ»å¯è¦–åŒ–API:**
- [x] çµ±è¨ˆã‚µãƒãƒªãƒ¼å–å¾—ï¼ˆ`GET /stats/summary`ï¼‰- å…¨æœŸé–“/ä»Šé€±/ä»Šæœˆ
- [x] ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆ`GET /stats/calendar`ï¼‰- æ—¥åˆ¥çµ±è¨ˆã€JSTå¯¾å¿œ

### ğŸš§ ä»Šå¾Œã®å®Ÿè£…äºˆå®šï¼ˆå„ªå…ˆåº¦é †ï¼‰
1. **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»æ¤œç´¢æ©Ÿèƒ½**
   - [ ] æ—¥ä»˜ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆstart_date, end_dateï¼‰
   - [ ] ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆæ—¥ä»˜é †ã€ã‚¹ã‚³ã‚¢é †ãªã©ï¼‰

2. **é€šçŸ¥æ©Ÿèƒ½**
   - [ ] ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ï¼ˆSendGrid/Resendçµ±åˆï¼‰
   - [ ] ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¨­å®šï¼ˆå®šæœŸå®Ÿè¡Œï¼‰

3. **Failureãƒ¢ãƒ‡ãƒ«ã®æ‹¡å¼µï¼ˆå°†æ¥çš„ãªæ©Ÿèƒ½ï¼‰**
   - [ ] challenge_contentï¼ˆæŒ‘æˆ¦å†…å®¹ï¼‰
   - [ ] failure_contentï¼ˆå¤±æ•—å†…å®¹ã®è©³ç´°ï¼‰
   - [ ] next_actionï¼ˆãƒã‚¯ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
   - [ ] challenge_levelï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸åº¦åˆã„: 1-3ï¼‰
   - [ ] novelty_levelï¼ˆæ–°ã—ã„åº¦åˆã„: 1-3ï¼‰

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

### Userï¼ˆå®Ÿè£…æ¸ˆã¿âœ…ï¼‰
```python
- id: UUID (PK)
- email: String (unique)
- hashed_password: String
- notification_time: Time (nullable)  # é€šçŸ¥æ™‚åˆ»ï¼ˆä¾‹: "20:00:00"ï¼‰
- created_at: DateTime
```

### Failureï¼ˆå®Ÿè£…æ¸ˆã¿âœ…ï¼‰
```python
- id: UUID (PK)
- user_id: UUID (FK -> User)
- content: Text              # å¤±æ•—å†…å®¹
- score: Integer             # ã‚¹ã‚³ã‚¢
- created_at: DateTime       # è¨˜éŒ²æ—¥æ™‚
- updated_at: DateTime       # æ›´æ–°æ—¥æ™‚
```

**å°†æ¥çš„ãªæ‹¡å¼µå€™è£œ:**
```python
- challenge_content: Text      # æŒ‘æˆ¦å†…å®¹
- failure_content: Text        # å¤±æ•—å†…å®¹ã®è©³ç´°
- next_action: Text           # ãƒã‚¯ã‚¹ãƒˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- challenge_level: Integer    # 1-3 (ãƒãƒ£ãƒ¬ãƒ³ã‚¸åº¦åˆã„)
- novelty_level: Integer      # 1-3 (æ–°ã—ã„åº¦åˆã„)
```

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ï¼šTDDï¼ˆTest-Driven Developmentï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰**ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

#### TDDã®åŸºæœ¬ã‚µã‚¤ã‚¯ãƒ«
1. **Red**: å¤±æ•—ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
2. **Green**: ãƒ†ã‚¹ãƒˆãŒé€šã‚‹æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
3. **Refactor**: ã‚³ãƒ¼ãƒ‰ã‚’æ”¹å–„ã™ã‚‹

#### å®Ÿè·µä¾‹
```python
# 1. ã¾ãšãƒ†ã‚¹ãƒˆã‚’æ›¸ãï¼ˆtests/test_failures.pyï¼‰
def test_create_failure(client, auth_token):
    response = client.post(
        "/failures",
        headers={"Authorization": f"Bearer {auth_token}"},
        json={
            "content": "æ–°ã—ã„è¨€èªã®ç’°å¢ƒæ§‹ç¯‰ã§è©°ã¾ã£ãŸ",
            "score": 5
        }
    )
    assert response.status_code == 201
    data = response.json()["data"]
    assert data["content"] == "æ–°ã—ã„è¨€èªã®ç’°å¢ƒæ§‹ç¯‰ã§è©°ã¾ã£ãŸ"
    assert data["score"] == 5

# 2. ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ï¼ˆmain.pyï¼‰
@app.post("/failures", response_model=SuccessResponse, status_code=201)
def create_failure(
    failure_data: FailureCreate,
    current_user: User = Depends(get_current_user),
    db: Session = Depends(get_db)
):
    # å®Ÿè£…...
    pass

# 3. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
```

#### TDDã®ãƒ¡ãƒªãƒƒãƒˆ
- ãƒã‚°ã®æ—©æœŸç™ºè¦‹
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å®‰å…¨æ€§
- ä»•æ§˜ã®æ˜ç¢ºåŒ–ï¼ˆãƒ†ã‚¹ãƒˆãŒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãªã‚‹ï¼‰
- å®Ÿè£…ã®æœ€å°åŒ–ï¼ˆå¿…è¦ãªæ©Ÿèƒ½ã ã‘ã‚’å®Ÿè£…ï¼‰

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
- Python 3.10ä»¥ä¸Š
- 1è¡Œã®æœ€å¤§æ–‡å­—æ•°: 100æ–‡å­—
- ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼: Ruffï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã€ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼‰
- å‹ãƒ’ãƒ³ãƒˆã‚’ç©æ¥µçš„ã«ä½¿ç”¨
- **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã§é–‹ç™º**ï¼ˆTDDæ¨å¥¨ï¼‰
- å„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã¯å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚’ä½œæˆ

### èªè¨¼ãƒ•ãƒ­ãƒ¼
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ç™»éŒ²
2. ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«JWTã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœ‰åŠ¹æœŸé™: 30æ—¥ï¼‰
3. ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯`Authorization: Bearer <token>`ãƒ˜ãƒƒãƒ€ãƒ¼ã§èªè¨¼
4. ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™
- ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¯çµ±ä¸€ã•ã‚ŒãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆ`{"detail": "error message"}`ï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§ä¸€è²«æ€§ã‚’ä¿ã¤

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv sync

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
python init_db.py

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
uvicorn main:app --reload

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest

# ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
ruff format .

# ãƒªãƒ³ã‚¿ãƒ¼å®Ÿè¡Œ
ruff check .
```

## APIä»•æ§˜

### èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### POST /auth/register
ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
```json
Request:
{
  "email": "user@example.com",
  "password": "password123",
  "notification_time": "20:00:00"  // optional
}

Response (201):
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "notification_time": "20:00:00",
    "created_at": "2024-01-01T00:00:00",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
  },
  "message": "User registered successfully."
}
```

#### POST /auth/login
ãƒ­ã‚°ã‚¤ãƒ³
```json
Request:
{
  "email": "user@example.com",
  "password": "password123"
}

Response (200):
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "notification_time": "20:00:00",
    "created_at": "2024-01-01T00:00:00",
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc..."
  },
  "message": "Login successful."
}
```

#### GET /auth/me
èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ï¼ˆè¦èªè¨¼ï¼‰
```json
Headers:
  Authorization: Bearer <token>

Response (200):
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "notification_time": "20:00:00",
    "created_at": "2024-01-01T00:00:00"
  },
  "message": "User information retrieved successfully."
}
```

#### PUT /auth/me
ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°ï¼ˆè¦èªè¨¼ï¼‰
```json
Headers:
  Authorization: Bearer <token>

Request:
{
  "notification_time": "09:30"  // HH:MMå½¢å¼ï¼ˆå¿…é ˆï¼‰
}

Response (200):
{
  "success": true,
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "notification_time": "09:30",
    "created_at": "2024-01-01T00:00:00"
  },
  "message": "User information updated successfully."
}
```

#### POST /auth/logout
ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆè¦èªè¨¼ï¼‰
```json
Headers:
  Authorization: Bearer <token>

Response (200):
{
  "success": true,
  "data": null,
  "message": "Logout successful. Please remove the token from the client."
}

Note: JWTã¯ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ãªãŸã‚ã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã¯ä½•ã‚‚å‡¦ç†ã—ã¾ã›ã‚“ã€‚
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã§ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚’å®Ÿç¾ã—ã¦ãã ã•ã„ã€‚
```

### å¤±æ•—è¨˜éŒ²ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### POST /failures
å¤±æ•—è¨˜éŒ²ä½œæˆï¼ˆè¦èªè¨¼ï¼‰
```json
Request:
{
  "content": "æ–°ã—ã„è¨€èªã®ç’°å¢ƒæ§‹ç¯‰ã§è©°ã¾ã£ãŸ",
  "score": 5
}

Response (201):
{
  "success": true,
  "data": {
    "id": "...",
    "user_id": "...",
    "content": "æ–°ã—ã„è¨€èªã®ç’°å¢ƒæ§‹ç¯‰ã§è©°ã¾ã£ãŸ",
    "score": 5,
    "created_at": "2024-01-01T12:00:00",
    "updated_at": "2024-01-01T12:00:00"
  },
  "message": "Failure record created successfully."
}
```

#### GET /failures
å¤±æ•—è¨˜éŒ²ä¸€è¦§å–å¾—ï¼ˆè¦èªè¨¼ï¼‰
```json
Query Parameters:
  - limit: int (default: 20)
  - offset: int (default: 0)

Response (200):
{
  "success": true,
  "data": [
    {
      "id": "...",
      "user_id": "...",
      "content": "...",
      "score": 5,
      "created_at": "2024-01-01T12:00:00",
      "updated_at": "2024-01-01T12:00:00"
    }
  ],
  "message": "Failure records retrieved successfully."
}
```

#### GET /failures/{failure_id}
å¤±æ•—è¨˜éŒ²è©³ç´°å–å¾—ï¼ˆè¦èªè¨¼ï¼‰
```json
Response (200):
{
  "success": true,
  "data": {
    "id": "...",
    "user_id": "...",
    "content": "...",
    "score": 5,
    "created_at": "2024-01-01T12:00:00",
    "updated_at": "2024-01-01T12:00:00"
  },
  "message": "Failure record retrieved successfully."
}
```

#### PUT /failures/{failure_id}
å¤±æ•—è¨˜éŒ²æ›´æ–°ï¼ˆè¦èªè¨¼ï¼‰
```json
Request:
{
  "content": "æ›´æ–°ã•ã‚ŒãŸå†…å®¹",  // optional
  "score": 7  // optional
}

Response (200):
{
  "success": true,
  "data": {
    "id": "...",
    "user_id": "...",
    "content": "æ›´æ–°ã•ã‚ŒãŸå†…å®¹",
    "score": 7,
    "created_at": "2024-01-01T12:00:00",
    "updated_at": "2024-01-02T10:00:00"
  },
  "message": "Failure record updated successfully."
}
```

#### DELETE /failures/{failure_id}
å¤±æ•—è¨˜éŒ²å‰Šé™¤ï¼ˆè¦èªè¨¼ï¼‰
```json
Response (200):
{
  "success": true,
  "data": null,
  "message": "Failure record deleted successfully."
}
```

### çµ±è¨ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### GET /stats/summary
çµ±è¨ˆã‚µãƒãƒªãƒ¼å–å¾—ï¼ˆè¦èªè¨¼ï¼‰
```json
Response (200):
{
  "success": true,
  "data": {
    "all_time": {
      "failure_count": 100,
      "total_score": 500,
      "average_score": 5.0
    },
    "this_week": {
      "failure_count": 5,
      "total_score": 25,
      "average_score": 5.0
    },
    "this_month": {
      "failure_count": 20,
      "total_score": 100,
      "average_score": 5.0
    }
  },
  "message": "Statistics summary retrieved successfully."
}
```

#### GET /stats/calendar
ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆè¦èªè¨¼ï¼‰
```json
Query Parameters:
  - year: int (required)
  - month: int (required, 1-12)

Response (200):
{
  "success": true,
  "data": {
    "year": 2024,
    "month": 1,
    "days": [
      {
        "date": "2024-01-15",
        "failure_count": 3,
        "total_score": 15,
        "average_score": 5.0
      }
    ]
  },
  "message": "Calendar data retrieved successfully."
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å®Ÿè£…æ¸ˆã¿
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯Argon2ã§ãƒãƒƒã‚·ãƒ¥åŒ–
- JWTèªè¨¼ã«ã‚ˆã‚‹ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™: 10æ—¥ï¼‰
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- notification_timeã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆHH:MMå½¢å¼ï¼‰
- JWTã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã®ç’°å¢ƒå¤‰æ•°åŒ–ï¼ˆ`JWT_SECRET_KEY`ï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šURLã®ç’°å¢ƒå¤‰æ•°åŒ–ï¼ˆ`DATABASE_URL`ï¼‰

### æ”¹å–„äºˆå®š
- [ ] JWTãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³å®Ÿè£…
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆRate Limitingï¼‰
- [ ] CORSè¨­å®šã®å³å¯†åŒ–
- [ ] æœ¬ç•ªç’°å¢ƒã§ã®HTTPSå¿…é ˆåŒ–

## CI/CD

### GitHub Actionsï¼ˆè¨­å®šæ¸ˆã¿âœ…ï¼‰

`.github/workflows/ci.yml`ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

#### ãƒˆãƒªã‚¬ãƒ¼
- `main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®push
- `develop`ãƒ–ãƒ©ãƒ³ãƒã¸ã®push
- Pull Requestä½œæˆæ™‚

#### å®Ÿè¡Œå†…å®¹
1. **Ruff Linter**: ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
2. **Ruff Formatter**: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
3. **pytest**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
4. **Coverage**: ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

#### ãƒãƒƒã‚¸ï¼ˆè¿½åŠ æ¨å¥¨ï¼‰
README.mdã«ä»¥ä¸‹ã®ãƒãƒƒã‚¸ã‚’è¿½åŠ ã™ã‚‹ã¨ã€CIçŠ¶æ…‹ãŒä¸€ç›®ã§ã‚ã‹ã‚Šã¾ã™ï¼š

```markdown
![CI](https://github.com/<username>/failure-bank/workflows/CI/badge.svg)
```

#### ãƒ­ãƒ¼ã‚«ãƒ«ã§CIã¨åŒã˜ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
```bash
cd backend

# ãƒªãƒ³ã‚¿ãƒ¼ãƒã‚§ãƒƒã‚¯
uv run ruff check .

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
uv run ruff format --check .

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
uv run pytest -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
uv run pytest --cov=. --cov-report=term
```

## ãƒ‡ãƒ—ãƒ­ã‚¤

### æœ¬ç•ªç’°å¢ƒè¦ä»¶
- PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- ç’°å¢ƒå¤‰æ•°è¨­å®š
  - `DATABASE_URL`: PostgreSQLæ¥ç¶šæ–‡å­—åˆ—
  - `JWT_SECRET_KEY`: JWTç½²åç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼
  - `SENDGRID_API_KEY` / `RESEND_API_KEY`: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ç”¨APIã‚­ãƒ¼

### Render / Railway ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
1. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«æ¥ç¶š
2. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
3. ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰: `uv sync`
4. èµ·å‹•ã‚³ãƒãƒ³ãƒ‰: `uvicorn main:app --host 0.0.0.0 --port $PORT`

### CDï¼ˆç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
å°†æ¥çš„ã«GitHub Actionsã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¨­å®šå¯èƒ½ï¼š
- `main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸æ™‚ã«æœ¬ç•ªç’°å¢ƒã¸è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
- `develop`ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒãƒ¼ã‚¸æ™‚ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã¸è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆæ–¹é‡ï¼ˆTDDï¼‰
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯**ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™º**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

1. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: å®Ÿè£…å‰ã«ãƒ†ã‚¹ãƒˆã‚’æ›¸ã
2. **ç‹¬ç«‹æ€§**: å„ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦å®Ÿè¡Œå¯èƒ½
3. **ãƒ†ã‚¹ãƒˆDB**: ãƒ†ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ãŸSQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ç”¨
4. **èªè¨¼ãƒ†ã‚¹ãƒˆ**: ä¿è­·ã•ã‚ŒãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§èªè¨¼
5. **ã‚«ãƒãƒ¬ãƒƒã‚¸**: ã‚³ãƒ¼ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å®šæœŸçš„ã«ç¢ºèª

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãå®Ÿè¡Œ
pytest --cov=. --cov-report=html

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿
pytest tests/test_auth.py

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ï¼‰
pytest-watch
```

### ãƒ†ã‚¹ãƒˆæ§‹æˆ
```
backend/tests/
â”œâ”€â”€ conftest.py           # ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
â”œâ”€â”€ test_auth.py          # èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
â”œâ”€â”€ test_failures.py      # å¤±æ•—è¨˜éŒ²ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
â””â”€â”€ test_stats.py         # çµ±è¨ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
```

## ä»Šå¾Œã®æ”¹å–„ãƒ»æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚¢

### Phase 2ï¼ˆMVPã®æ¬¡ï¼‰
- [ ] ã‚¿ã‚°ãƒ»ã‚«ãƒ†ã‚´ãƒªæ©Ÿèƒ½ï¼ˆå¤±æ•—ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ï¼‰
- [ ] æ¤œç´¢æ©Ÿèƒ½ï¼ˆå…¨æ–‡æ¤œç´¢ï¼‰
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆCSVã€JSONï¼‰
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ©Ÿèƒ½ï¼ˆç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèªå¾Œã«å¤‰æ›´ï¼‰
- [ ] ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´æ©Ÿèƒ½ï¼ˆãƒ¡ãƒ¼ãƒ«æ¤œè¨¼ä»˜ãï¼‰
- [ ] ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ï¼‰

### Phase 3ï¼ˆé•·æœŸçš„ãªæ‹¡å¼µï¼‰
- [ ] ã‚½ãƒ¼ã‚·ãƒ£ãƒ«æ©Ÿèƒ½ï¼ˆå¤±æ•—ã®å…±æœ‰ã€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ï¼‰
- [ ] AIåˆ†æï¼ˆå¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆï¼‰
- [ ] ç›®æ¨™è¨­å®šæ©Ÿèƒ½ï¼ˆæŒ‘æˆ¦ã®ç›®æ¨™ã‚’è¨­å®šï¼‰
- [ ] ãƒãƒƒã‚¸ãƒ»å ±é…¬ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚²ãƒ¼ãƒŸãƒ•ã‚£ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼ˆReact Native / Flutterï¼‰

## å‚è€ƒãƒªãƒ³ã‚¯

- [FastAPIå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://fastapi.tiangolo.com/)
- [SQLAlchemyå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.sqlalchemy.org/)
- [JWTå…¬å¼ã‚µã‚¤ãƒˆ](https://jwt.io/)

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚’è¨˜è¼‰ï¼‰

---

**Note**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²è¡Œã«åˆã‚ã›ã¦éšæ™‚æ›´æ–°ã—ã¦ãã ã•ã„ã€‚
